branches:
  only:
    - source
language: ruby
rvm:
  - 1.9.3
before_script: 
  - git config --global user.name "dlecan"
  - git config --global user.email "dev@dlecan.com"
  # Set read-write git origin
  - git remote set-url origin git@github.com:dlecan/dlecan.github.com.git
  # Unpack ssh key for git
  - echo -n $id_rsa_{00..30} >> ~/.ssh/id_rsa_base64
  - base64 --decode --ignore-garbage ~/.ssh/id_rsa_base64 > ~/.ssh/id_rsa
  - chmod 600 ~/.ssh/id_rsa
  # Disable SSH server fingerprint verification
  - echo -e "Host github.com\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
  # Set deployment target to github pages
  - bundle exec rake setup_github_pages[git@github.com:dlecan/dlecan.github.com.git]
  - git checkout -- _config.yml
script:
  - set LC_ALL=fr_FR.UTF-8
  - set LANG=fr_FR.UTF-8
  # Generate site
  - bundle exec rake generate
after_script:
  # Workaround for travis not to try run rake on generated site
  - ! 'echo ''script: "ls *.html"'' > public/.travis.yml'
  # Deploy!
#  - bundle exec rake deploy

env:
  global:
    # Repo read-write address
    - REPO="git@github.com:dlecan/dlecan.github.com"
# SSH key. Encoded. See https://gist.github.com/4242707